// ============================================================================
// The default profile
// ============================================================================

Profile
{
  name = default

  Supply
  {
    resource = ElectricCharge
    on_eva = 33.0
    on_rescue = 10000.0
    low_message = #KERBALISM_low_battery
    empty_message = #KERBALISM_empty_battery
    refill_message = #KERBALISM_refill_battery
  }

  Supply
  {
    resource = Food
    on_pod = 1.35    // 5 days
    on_rescue = 2.2  // 8 days
    low_message = #KERBALISM_low_food
    empty_message = #KERBALISM_empty_food
    refill_message = #KERBALISM_refill_food
  }

  Supply
  {
    resource = Water
    on_pod = 0.7     // 5 days
    on_rescue = 1.1  // 8 days
    low_message = #KERBALISM_low_water
    empty_message = #KERBALISM_empty_water
    refill_message = #KERBALISM_refill_water
  }

  Supply
  {
    resource = Oxygen
    on_pod = 187      // 5 days
    on_eva = 12.5     // 2 hrs
    on_rescue = 298   // 8 days
    low_message = #KERBALISM_low_oxygen
    empty_message = #KERBALISM_empty_oxygen
    refill_message = #KERBALISM_refill_oxygen
  }

  Supply
  {
    resource = CarbonDioxide
    low_message = #KERBALISM_low_co2
    empty_message = #KERBALISM_empty_co2
    refill_message = #KERBALISM_refill_co2
  }

  Supply
  {
    resource = Nitrogen
    on_rescue = 100.0
    low_message = #KERBALISM_low_nitrogen
    empty_message = #KERBALISM_empty_nitrogen
    refill_message = #KERBALISM_refill_nitrogen
  }

  Supply
  {
    resource = Hydrogen
    low_message = #KERBALISM_low_hydrogen
    empty_message = #KERBALISM_empty_hydrogen
    refill_message = #KERBALISM_refill_hydrogen
  }

  Supply
  {
    resource = Ammonia
    low_message = #KERBALISM_low_ammonia
    empty_message = #KERBALISM_empty_ammonia
    refill_message = #KERBALISM_refill_ammonia
  }

// ============================================================================
// Add Part Upgrade for upgradeable slots
// ============================================================================

// boost Mk3 Shuttle cockpit and Science Lab Nitrogen storage
@PART[mk3Cockpit_Shuttle,Large_Crewed_Lab]:NEEDS[ProfileDefault]:FOR[KerbalismDefault]
{
  @MODULE[Configure]:HAS[#title[Pod]]
  {
    @SETUP[Pressure?Control]
    {
    @RESOURCE[Nitrogen]
      {
        @amount *= 3
        @maxAmount *= 3
      }
    }
  }
}

// ============================================================================
// Add configurable supplies to inline containers
// ============================================================================

// container volume is in Liters, calculated from the containers size and stored in the parts .cfg file
// amount and maxAmount are percentages of a full container at atmospheric pressure, e.g. 1 = 100%, 0.5 = 50%, 5 = 500% (or pressurized to 5 bar)

@PART[kerbalism-container-inline-*,kerbalism-container-hex-*,kerbalism-container-radial-box-*]:NEEDS[ProfileDefault]:FOR[KerbalismDefault]
{
  MODULE
  {
    name = Configure
    title = Supply Container
    slots = 1
    symmetric = true

    SETUP
    {
      name = Supplies  //  Ratio of Food and Water amounts are the same as a Kerbals intake
      desc = #KERBALISM_SupplyContainer_desc//Store a balanced supply of <b>Food</b> and <b>Water</b>.

      RESOURCE
      {
        name = Food
        amount = 0.7221584
        maxAmount = 0.7221584
        @amount *= #$/ContainerVolume$
        @maxAmount *= #$/ContainerVolume$
      }

      RESOURCE
      {
        name = Water
        amount = 0.2778416
        maxAmount = 0.2778416
        @amount *= #$/ContainerVolume$
        @maxAmount *= #$/ContainerVolume$
      }
    }

    SETUP
    {
      name = Food

      RESOURCE
      {
        name = Food
        amount = 1
        maxAmount = 1
        @amount *= #$/ContainerVolume$
        @maxAmount *= #$/ContainerVolume$
      }
    }

    SETUP
    {
      name = Water

      RESOURCE
      {
        name = Water
        amount = 1
        maxAmount = 1
        @amount *= #$/ContainerVolume$
        @maxAmount *= #$/ContainerVolume$
      }
    }

    SETUP
    {
      name = Sewage  //  Ratio of Waste and WasteWater amounts are the same as a Kerbals output
      desc = #KERBALISM_SupplyContainer_desc2//Store solid and liquid organic <b>Waste</b>.

      RESOURCE
      {
        name = Waste
        amount = 0
        maxAmount = 0.4946378
        @amount *= #$/ContainerVolume$
        @maxAmount *= #$/ContainerVolume$
      }

      RESOURCE
      {
        name = WasteWater
        amount = 0
        maxAmount = 0.5053622
        @amount *= #$/ContainerVolume$
        @maxAmount *= #$/ContainerVolume$
      }
    }

    SETUP
    {
      name = Waste

      RESOURCE
      {
        name = Waste
        amount = 0
        maxAmount = 1
        @amount *= #$/ContainerVolume$
        @maxAmount *= #$/ContainerVolume$
      }
    }

    SETUP
    {
      name = WasteWater

      RESOURCE
      {
        name = WasteWater
        amount = 0
        maxAmount = 1
        @amount *= #$/ContainerVolume$
        @maxAmount *= #$/ContainerVolume$
      }
    }
  }
}


// ============================================================================
// Add configurable supplies to radial containers
// ============================================================================

// container volume is in Liters, calculated from the containers size and stored in the parts .cfg file
// amount and maxAmount are percentages of a full container at atmospheric pressure, e.g. 1 = 100%, 0.5 = 50%, 5 = 500% (or pressurized to 5 bar)

@PART[kerbalism-container-radial-pressurized-*,kerbalism-container-radial-big,kerbalism-container-radial-huge,kerbalism-container-radial-medium,kerbalism-container-radial-small]:NEEDS[ProfileDefault]:FOR[KerbalismDefault]
{
  MODULE
  {
    name = Configure
    title = Pressurized Tank
    slots = 1
    symmetric = true

    SETUP
    {
      name = Oxygen  // Stored at 200 bar (2940psi) when full
      desc = #KERBALISM_PressurizedTank_desc//Store pressurized <b>Oxygen</b> gas @ 200 bar.

      RESOURCE
      {
        name = Oxygen
        amount = 200
        maxAmount = 200
        @amount *= #$/ContainerVolume$
        @maxAmount *= #$/ContainerVolume$
      }
    }

    SETUP
    {
      name = Nitrogen  // Stored at 180 bar (2646psi) when full
      desc = #KERBALISM_PressurizedTank_desc2//Store pressurized <b>Nitrogen</b> gas @ 180 bar.

      RESOURCE
      {
        name = Nitrogen
        amount = 180
        maxAmount = 180
        @amount *= #$/ContainerVolume$
        @maxAmount *= #$/ContainerVolume$
      }
    }

    SETUP
    {
      name = Hydrogen  // Stored at 700 bar (10290psi) when full
      desc = #KERBALISM_PressurizedTank_desc3//Store pressurized <b>Hydrogen</b> gas @ 700 bar.

      RESOURCE
      {
        name = Hydrogen
        amount = 700
        maxAmount = 700
        @amount *= #$/ContainerVolume$
        @maxAmount *= #$/ContainerVolume$
      }
    }

    SETUP
    {
      name = Ammonia  // Stored at 35 bar (515psi) when full
      desc = #KERBALISM_PressurizedTank_desc4//Store pressurized <b>Ammonia</b> gas @ 35 bar.

      RESOURCE
      {
        name = Ammonia
        amount = 35
        maxAmount = 35
        @amount *= #$/ContainerVolume$
        @maxAmount *= #$/ContainerVolume$
      }
    }

    SETUP
    {
      name = CarbonDioxide  // Stored at 60bar (882psi) when full
      desc = #KERBALISM_PressurizedTank_desc5//Store pressurized <b>Carbon dioxide</b> gas @ 60 bar.

      RESOURCE
      {
        name = CarbonDioxide
        amount = 60
        maxAmount = 60
        @amount *= #$/ContainerVolume$
        @maxAmount *= #$/ContainerVolume$
      }
    }

    SETUP
    {
      name = Xenon Gas  // Stored at 85 bar (1250psi) when full
						// see https://www.cobham.com/mission-systems/composite-pressure-solutions/space-systems/xenon-propellant-tank-datasheet/
      desc = #KERBALISM_PressurizedTank_desc6//Store pressurized <b>Xenon</b> gas @ 85 bar.
      tech = ionPropulsion

      RESOURCE
      {
        name = XenonGas
        amount = 85
        maxAmount = 85
        @amount *= #$/ContainerVolume$
        @maxAmount *= #$/ContainerVolume$
      }
    }
  }
}


// You get a slot upgrade, and you get a slot upgrade, EVERYONE gets a slot upgrade!
// Had to fix unintended shenenigans, assuming whoever patched this initially never expected multiple configures on the same part.
@PART[*]:HAS[@MODULE[Configure]]:NEEDS[ProfileDefault]:FOR[zzzKerbalismDefault]
{ 	@MODULE[Configure]:HAS[#title[Pod]] 			{ @UPGRADES { @UPGRADE:HAS[#name__[Upgrade?Slots]] { @slots = #$../../slots$
      @slots += 1 } } }
	@MODULE[Configure]:HAS[#title[Life?Support]] 	{ @UPGRADES { @UPGRADE:HAS[#name__[Upgrade?Slots]] { @slots = #$../../slots$
      @slots += 1 } } }
	@MODULE[Configure]:HAS[#title[Chemical?Plant]] 	{ @UPGRADES { @UPGRADE:HAS[#name__[Upgrade?Slots]] { @slots = #$../../slots$
      @slots += 1 } } }
}

// tweak number of slots
@PART[MK1CrewCabin|Mark2Cockpit|cupola]:NEEDS[ProfileDefault]:FOR[zzzKerbalismDefault] 		{ @MODULE[Configure]:HAS[#title[Pod]] { @slots = 1 } }
@PART[mk3Cockpit_Shuttle]:NEEDS[ProfileDefault]:FOR[zzzKerbalismDefault] 						{ @MODULE[Configure]:HAS[#title[Pod]] { @slots = 3 } }

// ============================================================================
// Pseudo-resources used by processes
// ============================================================================

RESOURCE_DEFINITION
{
  name = _NonRegenScrubber
  density = 0.0
  isVisible = false
}

RESOURCE_DEFINITION
{
  name = _Scrubber
  density = 0.0
  isVisible = false
}

RESOURCE_DEFINITION
{
  name = _PressureControl
  density = 0.0
  isVisible = false
}

RESOURCE_DEFINITION
{
  name = _AirPump
  density = 0.0
  isVisible = false
}

RESOURCE_DEFINITION
{
  name = _WaterRecycler
  density = 0.0
  isVisible = false
}

RESOURCE_DEFINITION
{
  name = _WasteProcessor
  density = 0.0
  isVisible = false
}

RESOURCE_DEFINITION
{
  name = _ECGen
  density = 0.0
  isVisible = false
}

RESOURCE_DEFINITION
{
  name = _RTG
  density = 0.0
  isVisible = false
}

RESOURCE_DEFINITION
{
  name = _FuelCell
  density = 0.0
  isVisible = false
}

RESOURCE_DEFINITION
{
  name = _MonopropFuelCell
  density = 0.0
  isVisible = false
}

RESOURCE_DEFINITION
{
  name = _WaterElectrolysis
  density = 0.0
  isVisible = false
}

RESOURCE_DEFINITION
{
  name = _Sabatier
  density = 0.0
  isVisible = false
}

RESOURCE_DEFINITION
{
  name = _Haber
  density = 0.0
  isVisible = false
}

RESOURCE_DEFINITION
{
  name = _WasteIncinerator
  density = 0.0
  isVisible = false
}

RESOURCE_DEFINITION
{
  name = _WasteCompressor
  density = 0.0
  isVisible = false
}

RESOURCE_DEFINITION
{
  name = _Anthraquinone
  density = 0.0
  isVisible = false
}

RESOURCE_DEFINITION
{
  name = _HydrazineProduction
  density = 0.0
  isVisible = false
}

RESOURCE_DEFINITION
{
  name = _NitroHydrazine
  density = 0.0
  isVisible = false
}

RESOURCE_DEFINITION
{
  name = _SOE
  density = 0.0
  isVisible = false
}

RESOURCE_DEFINITION
{
  name = _MRE
  density = 0.0
  isVisible = false
}

RESOURCE_DEFINITION
{
  name = _SCO
  density = 0.0
  isVisible = false
}

@RESOURCE_DEFINITION[Nitrogen]    // Remove Nitrogen from fuel flow priorities (Don't know what RoverDude was thinking??)
{
  @flowMode = ALL_VESSEL
}

// adding mass to a kerbal leads to all sorts of oddities in KSP.
// 1. the crew mass isn't accounted for in the editor immediately after adding/removing crew.
//    you have to make an additional change to the vessel for the numbers to add up.
// 2. a kerbal on EVA already has a mass of > 100kg in stock. the crew mass would be ADDED to that.
//    this would produce 95k of mass out of nothing for each EVA.
// it's convoluted, and I won't bother messing around with that any more.
//@PHYSICSGLOBALS:FOR[KerbalismDefault]
//{
//    %kerbalCrewMass = 0.09375
//}
